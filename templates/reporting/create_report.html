{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Create Property Report</h2>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="mb-3">
            {{ form.house_number.label_tag }}
            {{ form.house_number }}
        </div>

        <div class="mb-3">
            {{ form.violation.label_tag }}
            {{ form.violation }}
        </div>

        <div class="mb-3">
            {{ form.description.label_tag }}
            {{ form.description }}
        </div>

        <div class="mb-3">
            {{ form.image.label_tag }}
            {{ form.image }}
        </div>


        <div class="mb-3">
            <label>Select Location on Map</label>
            <div id="map" style="height:350px; border-radius:8px;"></div>
        </div>

        {{ form.latitude }}
        {{ form.longitude }}

        <button type="submit" class="btn btn-primary mt-2">Submit Report</button>
        <a href="{% url 'report_list' %}" class="btn btn-secondary mt-2">Cancel</a>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    var map = L.map('map').setView([-17.898, 31.079], 16); // default Harare
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    var marker;
    map.on('click', function(e) {
        var lat = e.latlng.lat.toFixed(6);
        var lng = e.latlng.lng.toFixed(6);

        if (marker) {
            marker.setLatLng(e.latlng);
        } else {
            marker = L.marker(e.latlng).addTo(map);
        }

        document.getElementById("id_latitude").value = lat;
        document.getElementById("id_longitude").value = lng;
    });
});
</script>
{% endblock %}
